<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeMate AI â€” Asisten Coding Kamu</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface2: #1a1a26;
    --border: #2a2a3d;
    --accent: #00e5b0;
    --accent2: #7c3aed;
    --text: #e8e8f0;
    --muted: #6b6b8a;
    --user-bubble: #1e1e30;
    --ai-bubble: #0f1f1a;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Syne', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    top: -30%; left: -10%;
    width: 60%; height: 60%;
    background: radial-gradient(ellipse, rgba(0,229,176,0.04) 0%, transparent 70%);
    pointer-events: none;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -20%; right: -10%;
    width: 50%; height: 50%;
    background: radial-gradient(ellipse, rgba(124,58,237,0.05) 0%, transparent 70%);
    pointer-events: none;
  }

  header {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 14px;
    background: rgba(10,10,15,0.8);
    backdrop-filter: blur(10px);
    flex-shrink: 0;
    z-index: 10;
  }

  .logo {
    width: 38px; height: 38px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
  }

  .header-text h1 { font-size: 18px; font-weight: 800; letter-spacing: -0.5px; }
  .header-text p { font-size: 12px; color: var(--muted); font-family: 'JetBrains Mono', monospace; }

  .status-dot {
    margin-left: auto;
    display: flex; align-items: center; gap: 6px;
    font-size: 12px; color: var(--muted);
  }
  .dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 8px var(--accent);
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  #chat {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    scroll-behavior: smooth;
  }
  #chat::-webkit-scrollbar { width: 4px; }
  #chat::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  #welcome {
    margin: auto;
    text-align: center;
    animation: fadeUp 0.5s ease;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  #welcome .big-icon { font-size: 52px; margin-bottom: 16px; display: block; }
  #welcome h2 {
    font-size: 26px; font-weight: 800; margin-bottom: 8px;
    background: linear-gradient(135deg, var(--accent), #fff 60%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  }
  #welcome p { color: var(--muted); font-size: 14px; margin-bottom: 28px; line-height: 1.6; }

  .suggestion-chips {
    display: flex; flex-wrap: wrap; gap: 8px;
    justify-content: center; max-width: 520px; margin: 0 auto;
  }
  .chip {
    padding: 8px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 13px; color: var(--muted);
    cursor: pointer; transition: all 0.2s;
    font-family: 'JetBrains Mono', monospace;
  }
  .chip:hover { border-color: var(--accent); color: var(--accent); background: rgba(0,229,176,0.05); }

  .message {
    display: flex; gap: 12px;
    animation: fadeUp 0.3s ease;
    max-width: 860px; width: 100%; margin: 0 auto;
  }
  .message.user { flex-direction: row-reverse; }

  .avatar {
    width: 32px; height: 32px;
    border-radius: 10px;
    flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 15px;
  }
  .message.user .avatar { background: var(--accent2); }
  .message.ai .avatar { background: linear-gradient(135deg, var(--accent), #00a07a); }

  .bubble {
    padding: 14px 18px;
    border-radius: 16px;
    line-height: 1.65;
    font-size: 14.5px;
    max-width: calc(100% - 50px);
    white-space: pre-wrap;
    word-break: break-word;
  }
  .message.user .bubble {
    background: var(--user-bubble);
    border: 1px solid var(--border);
    border-top-right-radius: 4px;
  }
  .message.ai .bubble {
    background: var(--ai-bubble);
    border: 1px solid rgba(0,229,176,0.15);
    border-top-left-radius: 4px;
  }

  .message.ai .bubble p { margin-bottom: 10px; }
  .message.ai .bubble p:last-child { margin-bottom: 0; }

  .message.ai .bubble pre {
    background: #0d1117;
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow-x: auto;
    margin: 12px 0;
    position: relative;
  }
  .message.ai .bubble pre code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    padding: 16px !important;
    display: block;
  }
  .copy-btn {
    position: absolute; top: 8px; right: 8px;
    padding: 4px 10px;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 6px; color: var(--muted);
    font-size: 11px; cursor: pointer;
    font-family: 'JetBrains Mono', monospace;
    transition: all 0.2s;
  }
  .copy-btn:hover { color: var(--accent); border-color: var(--accent); }

  .message.ai .bubble code:not(pre code) {
    background: rgba(0,229,176,0.1);
    color: var(--accent);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
  }
  .message.ai .bubble strong { color: #fff; }

  .typing-dots { display: flex; gap: 4px; align-items: center; padding: 4px 0; }
  .typing-dots span {
    width: 6px; height: 6px;
    background: var(--accent); border-radius: 50%;
    animation: blink 1.4s infinite;
  }
  .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
  .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes blink {
    0%, 80%, 100% { opacity: 0.2; transform: scale(0.8); }
    40% { opacity: 1; transform: scale(1); }
  }

  #input-area {
    padding: 16px 24px 20px;
    border-top: 1px solid var(--border);
    background: rgba(10,10,15,0.9);
    backdrop-filter: blur(10px);
    flex-shrink: 0;
  }
  .input-box {
    max-width: 860px; margin: 0 auto;
    display: flex; gap: 10px; align-items: flex-end;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 10px 14px;
    transition: border-color 0.2s;
  }
  .input-box:focus-within { border-color: var(--accent); }

  #user-input {
    flex: 1; background: none; border: none; outline: none;
    color: var(--text);
    font-family: 'Syne', sans-serif; font-size: 14.5px;
    resize: none; max-height: 140px; line-height: 1.5;
  }
  #user-input::placeholder { color: var(--muted); }

  #send-btn {
    width: 36px; height: 36px;
    background: var(--accent); border: none; border-radius: 10px;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; transition: all 0.2s;
  }
  #send-btn:hover { background: #00c497; transform: scale(1.05); }
  #send-btn:disabled { background: var(--border); cursor: not-allowed; transform: none; }
  #send-btn svg { width: 16px; height: 16px; fill: #000; }

  .input-hint {
    max-width: 860px; margin: 6px auto 0;
    font-size: 11px; color: var(--muted);
    text-align: center; font-family: 'JetBrains Mono', monospace;
  }

  .toast {
    position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
    background: var(--surface2); border: 1px solid var(--accent);
    color: var(--accent); padding: 10px 20px; border-radius: 30px;
    font-size: 13px; font-family: 'JetBrains Mono', monospace;
    animation: fadeUp 0.3s ease; z-index: 100;
  }
</style>
</head>
<body>

<header>
  <div class="logo">ðŸ’»</div>
  <div class="header-text">
    <h1>CodeMate AI</h1>
    <p>powered by claude-haiku-4-5</p>
  </div>
  <div class="status-dot">
    <span class="dot"></span>
    <span>Online</span>
  </div>
</header>

<div id="chat">
  <div id="welcome">
    <span class="big-icon">ðŸ¤–</span>
    <h2>Halo! Saya CodeMate</h2>
    <p>Asisten coding kamu. Tanya apa saja tentang<br>programming, debug, atau konsep baru!</p>
    <div class="suggestion-chips">
      <span class="chip" onclick="sendSuggestion(this)">Apa itu REST API?</span>
      <span class="chip" onclick="sendSuggestion(this)">Cara membuat for loop di Python</span>
      <span class="chip" onclick="sendSuggestion(this)">Perbedaan == dan === di JavaScript</span>
      <span class="chip" onclick="sendSuggestion(this)">Apa itu async/await?</span>
      <span class="chip" onclick="sendSuggestion(this)">Contoh SQL JOIN</span>
      <span class="chip" onclick="sendSuggestion(this)">Cara debug error NullPointerException</span>
    </div>
  </div>
</div>

<div id="input-area">
  <div class="input-box">
    <textarea id="user-input" rows="1" placeholder="Tanya tentang coding... (Enter untuk kirim, Shift+Enter untuk baris baru)"></textarea>
    <button id="send-btn" onclick="sendMessage()">
      <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
    </button>
  </div>
  <p class="input-hint">Enter kirim â€¢ Shift+Enter baris baru</p>
</div>

<script>
  const chatEl = document.getElementById('chat');
  const inputEl = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  const welcomeEl = document.getElementById('welcome');

  let conversationHistory = [];
  let isLoading = false;

  inputEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  inputEl.addEventListener('input', () => {
    inputEl.style.height = 'auto';
    inputEl.style.height = Math.min(inputEl.scrollHeight, 140) + 'px';
  });

  function sendSuggestion(chip) {
    inputEl.value = chip.textContent;
    sendMessage();
  }

  async function sendMessage() {
    const text = inputEl.value.trim();
    if (!text || isLoading) return;

    if (welcomeEl) welcomeEl.style.display = 'none';

    appendMessage('user', text);
    conversationHistory.push({ role: 'user', content: text });
    inputEl.value = '';
    inputEl.style.height = 'auto';

    const typingId = showTyping();
    isLoading = true;
    sendBtn.disabled = true;

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages: conversationHistory })
      });

      removeTyping(typingId);

      const data = await response.json();
      if (!response.ok) throw new Error(data.error || 'Request gagal');

      conversationHistory.push({ role: 'assistant', content: data.reply });
      appendMessage('ai', data.reply);

    } catch (err) {
      removeTyping(typingId);
      appendMessage('ai', `âŒ **Error:** ${err.message}`);
    } finally {
      isLoading = false;
      sendBtn.disabled = false;
      inputEl.focus();
    }
  }

  function appendMessage(role, content) {
    const msg = document.createElement('div');
    msg.className = `message ${role}`;

    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.textContent = role === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';

    const bubble = document.createElement('div');
    bubble.className = 'bubble';

    if (role === 'ai') {
      bubble.innerHTML = formatMarkdown(content);
      bubble.querySelectorAll('pre code').forEach(block => {
        hljs.highlightElement(block);
        const pre = block.parentElement;
        const btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.textContent = 'copy';
        btn.onclick = () => {
          navigator.clipboard.writeText(block.textContent);
          btn.textContent = 'âœ“ copied';
          setTimeout(() => btn.textContent = 'copy', 2000);
        };
        pre.appendChild(btn);
      });
    } else {
      bubble.textContent = content;
    }

    msg.appendChild(avatar);
    msg.appendChild(bubble);
    chatEl.appendChild(msg);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  function formatMarkdown(text) {
    return text
      .replace(/```(\w*)\n?([\s\S]*?)```/g, (_, lang, code) =>
        `<pre><code class="language-${lang || 'plaintext'}">${escapeHtml(code.trim())}</code></pre>`)
      .replace(/`([^`]+)`/g, '<code>$1</code>')
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .split('\n\n').map(p => p.trim() ? `<p>${p.replace(/\n/g, '<br>')}</p>` : '').join('');
  }

  function escapeHtml(t) {
    return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function showTyping() {
    const id = 'typing_' + Date.now();
    const msg = document.createElement('div');
    msg.className = 'message ai'; msg.id = id;
    const av = document.createElement('div');
    av.className = 'avatar'; av.textContent = 'ðŸ¤–';
    const bub = document.createElement('div');
    bub.className = 'bubble';
    bub.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
    msg.appendChild(av); msg.appendChild(bub);
    chatEl.appendChild(msg);
    chatEl.scrollTop = chatEl.scrollHeight;
    return id;
  }

  function removeTyping(id) {
    const el = document.getElementById(id);
    if (el) el.remove();
  }
</script>
</body>
</html>
